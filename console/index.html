<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>콘솔 비용 계산기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;400;700&display=swap" rel="stylesheet">

  <style>
    body {
      background:
        linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)),
        url('https://arrrbang.github.io/CostCalculator/image/background.jpg') no-repeat center center / cover;
      background-attachment: fixed;
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      padding: 0;
    }

    .three-column-layout {
      display: flex;
      gap: 30px;
      padding: 30px;
    }

    .logo-column {
      position: relative;
      flex: 0 0 180px;
      min-width: 120px;
      max-width: 150px;
      padding: 50px 0 0 24px;
    }

    .logo-wrapper {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
    }
    
    .logo-wrapper img {
      width: 150px;
      height: auto;
      display: block;
    }

    .button-under-logo {
      position: absolute;
      top: 95px;                     /* 로고 아래로 75px */
      left: 20px;
      z-index: 10;
      width: 150px;
    }

      .logo-wrapper,
      .button-under-logo {
        position: fixed;   /* ← absolute → fixed 로 변경 */
        left: 20px;
      }

    .button-under-logo a {
      display: block;
      width: 100%;
      text-align: center;
      font-size: 14px;
      color: #2e7d32;
      text-decoration: none;
      background-color: #e8f5e9;
      padding: 8px 0;
      border-radius: 6px;
      font-weight: bold;
      transition: background-color 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      white-space: nowrap;
    }

    .button-under-logo a:hover {
      background-color: #d0ebd2;
    }

    .info-column {
      display: flex;
      flex-direction: column;   /* 세로 방향 */
      gap: 24px;                /* 카드 간 간격 */
      flex: 1;
      background: transparent;  /* ♻ 흰 배경 제거 */
      padding: 0;               /* ♻ 내부 패딩 제거 */
    }
    
    .left-container {
      background: #ffffff;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    }
    

    .form-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .form-row label {
      font-weight: bold;
      flex: 1;
    }

    .form-row input {
      flex: 1;
      margin-left: 10px;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .form-row select {
      flex: 1;
      margin-left: 10px;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      background-color: white;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }
    
    .cost-column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 24px;
      background: transparent;
      padding: 0;
    }
    
    /* 오른쪽 열 안에서 흰색 박스 감싸는 래퍼 */
    .right-container {
      display: flex;
      justify-content: center;
    }
    
    /* 흰색 박스 자체 */
    .right-box {
      background: #ffffff;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      width: 100%;
      max-width: 500px;   /* 가운데 열과 맞춤 */
      box-sizing: border-box;
    }
    
    /* 값 출력 영역도 input/select처럼 스타일 통일 */
    .readonly-output {
      flex: 1;
      margin-left: 10px;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      background-color: #f9f9f9;
    }
        
    h2 {
      background-color: #8BC34A;   /* 연두색 배경 */
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: bold;
      margin: 0 0 16px 0;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .toggle-row {
      cursor: pointer;
    }
    
      .description-box {
        max-height: 0;
        overflow: hidden;
        background-color: #f8f8f8;
        border: 1px solid #ddd;
        border-radius: 8px;
        margin: -8px 0 16px 0;
        padding: 0 16px;
        font-size: 0.9rem;
        color: #444;
        transition: all 0.3s ease;
      }

      .description-box.open {
        padding: 12px 16px;
        max-height: 200px;
      }
    
      .arrow {
        display: inline-block;
        width: 1.2em;
        text-align: center;
        margin-right: 6px;
        transition: transform 0.3s ease;
      }

      .currency-total {
        text-align: right;
        font-weight: bold;
        margin: 4px 0;
      }
     
  </style>
</head>

<body>
  <div class="three-column-layout">
    <!-- 로고 및 버튼 열 -->
    <div class="logo-column">
      <div class="logo-wrapper">
        <img src="https://arrrbang.github.io/CostCalculator/image/pumexlogonew.png" alt="Logo">
      </div>

      <div class="button-under-logo">
        <a href="https://arrrbang.github.io/CostCalculator/selectpage.html">← 검색 페이지로</a>
      </div>
    </div>

    <!-- 입력 폼 열 -->
  <div class="info-column">
    <div class="left-container" id="rate-card">
      <div class="form-row">
        <label for="rate-40hc">현재 40HC 운임 :</label>
        <input type="number" id="rate-40hc" placeholder="예: 2850">
      </div>

      <div class="form-row">
        <label for="poe">도착지 :</label>
        <select id="poe">
          <option value="">선택하세요</option>
        </select>
      </div>
  
      <div class="form-row">
        <label for="partner">도착지 파트너 :</label>
        <select id="partner">
          <option value="">선택하세요</option>
        </select>
      </div>
      
    </div>
  
    <div class="left-container" id="console-card">
      <div class="form-row">
        <label for="console-select">콘솔업체 :</label>
        <select id="console-select">
          <option value="">선택하세요</option>
        </select>
      </div>

      <div class="form-row">
        <label for="console-cbm">콘솔 CBM :</label>
        <input type="number" id="console-cbm" placeholder="예: 30">
      </div>

      <div class="form-row">
        <label for="total-cbm">컨테이너 전체 CBM :</label>
        <input type="number" id="total-cbm" placeholder="예: 65">
      </div>
  
      <div class="form-row">
        <label for="cbm-rate">CBM당 운임 :</label>
        <input type="number" id="cbm-rate" placeholder="예: 120">
      </div>
    </div>
  </div>

    <div class="cost-column">
      <div class="right-container">
        <div class="right-box" id="cost-summary-box">
          <h2 id="console-cost-title">[콘솔업체 콘솔 작업시 비용]</h2>
          
            <!-- 국내 비용 -->
            <div class="form-row toggle-row" onclick="toggleDesc('domestic-desc', this)">
              <label><span class="arrow">▶</span> 국내 비용 :</label>
              <div class="readonly-output" id="domestic-cost">₩0</div>
            </div>
            <div class="description-box" id="domestic-desc"></div>
            
            <!-- 도착지 비용 -->
            <div class="form-row toggle-row" onclick="toggleDesc('arrival-desc', this)">
              <label><span class="arrow">▶</span> 도착지 비용 :</label>
              <div class="readonly-output" id="arrival-cost">$0</div>
            </div>
            <div class="description-box" id="arrival-desc"></div>
          <div class="currency-total overall-total">
            합계(KRW) : <span id="console-total-krw">0</span>
          </div>
        </div>
      </div>
      
      <div class="right-container">
        <div class="right-box" id="pumex-cost-summary-box">
          <h2 id="pumex-cost-title">[PUMEX 콘솔 작업시 비용]</h2>
      
          <!-- 국내 비용 -->
          <div class="form-row toggle-row" onclick="toggleDesc('pumex-domestic-desc', this)">
            <label><span class="arrow">▶</span> 국내 비용 :</label>
            <div class="readonly-output" id="pumex-domestic-cost">₩0</div>
          </div>
          <div class="description-box" id="pumex-domestic-desc"></div>
      
          <!-- 도착지 비용 -->
          <div class="form-row toggle-row" onclick="toggleDesc('pumex-arrival-desc', this)">
            <label><span class="arrow">▶</span> 도착지 비용 :</label>
            <div class="readonly-output" id="pumex-arrival-cost">$0</div>
          </div>
          <div class="description-box" id="pumex-arrival-desc"></div>
          <div class="currency-total overall-total">
            합계(KRW) : <span id="pumex-total-krw">0</span>
          </div>
        </div>
      </div>
      
    </div>
    
  </div>
</body>

<script>
  
// --------- 전역 변수 ---------
let gData = {};
let usdToKrwRate = 1400; // 기본값, 이후 환율 API로 갱신됨

// --------- 요소 선택 ---------
const poeSel = document.getElementById('poe');
const partnerSel = document.getElementById('partner');
const consoleSel = document.getElementById('console-select');
const cbmRateInput = document.getElementById('cbm-rate');
const rate40hcInput = document.getElementById('rate-40hc');
const consoleCbmInput = document.getElementById('console-cbm');
const totalCbmInput = document.getElementById('total-cbm');

const domesticCostBox = document.getElementById('domestic-cost');
const domesticDescBox = document.getElementById('domestic-desc');
const arrivalCostBox = document.getElementById('arrival-cost');
const arrivalDescBox = document.getElementById('arrival-desc');
const domesticSumBox = document.getElementById('domestic-total-krw');

const pumexDomesticCostBox = document.getElementById('pumex-domestic-cost');
const pumexDomesticDescBox = document.getElementById('pumex-domestic-desc');
const pumexArrivalCostBox = document.getElementById('pumex-arrival-cost');
const pumexArrivalDescBox = document.getElementById('pumex-arrival-desc');
const pumexSumBox = document.getElementById('pumex-total-krw');


// --------- 초기 JSON 로드 ---------
fetch('cost.json')
  .then(res => res.json())
  .then(json => {
    gData = json.poe || {};
    Object.keys(gData).forEach(k => {
      const opt = new Option(k.toUpperCase(), k);
      poeSel.appendChild(opt);
    });
  });

// --------- 환율 정보 로드 ---------
fetch('https://quotation-api-cdn.dunamu.com/v1/forex/recent?codes=FRX.KRWUSD')
  .then(res => res.json())
  .then(data => {
    const rate = parseFloat(data?.[0]?.basePrice);
    if (!isNaN(rate)) usdToKrwRate = rate;
  });

// --------- POE 변경시 드롭다운 ---------
poeSel.addEventListener('change', () => {
  const key = poeSel.value;
  partnerSel.innerHTML = '<option value="">선택하세요</option>';
  consoleSel.innerHTML = '<option value="">선택하세요</option>';
  if (!key) return;
  const node = gData[key];
  if (node.partner) Object.keys(node.partner).forEach(p => partnerSel.appendChild(new Option(p, p)));
  if (node.console) Object.keys(node.console).forEach(c => consoleSel.appendChild(new Option(c, c)));
});

// --------- 콘솔업체 이름 표시 ---------
consoleSel.addEventListener('change', e => {
  const name = e.target.value;
  document.getElementById('console-cost-title').textContent = name ? `[${name}] 콘솔 작업시 비용` : `[콘솔업체] 콘솔 작업시 비용`;
});

// --------- 토글 ---------
function toggleDesc(id, trigger) {
  const box = document.getElementById(id);
  if (!box) return;
  const isOpen = box.classList.toggle("open");
  if (trigger) {
    const arrow = trigger.querySelector(".arrow");
    if (arrow) arrow.style.transform = isOpen ? "rotate(90deg)" : "rotate(0deg)";
  }
}

// --------- 반올림 함수 ---------
const roundKRW = v => Math.round(v);
const roundUSD = v => Math.round(v * 100) / 100;

// --------- 콘솔업체 국내 비용 ---------
function updateDomesticDesc() {
  const poeKey = poeSel.value;
  const consoleKey = consoleSel.value;
  const cbmRate = +cbmRateInput.value || 0;
  const consoleCbm = +consoleCbmInput.value || 0;

  if (!poeKey || !consoleKey) {
    domesticCostBox.innerHTML = '₩0';
    domesticDescBox.innerHTML = '';
    domesticSumBox.innerHTML = '합계(KRW) : ₩0';
    return;
  }

  const node = gData[poeKey];
  const company = node.console?.[consoleKey] || {};

  let usdTotal = cbmRate * consoleCbm;
  let krwTotal = 0;

  const lines = [`OFC : $${roundUSD(usdTotal).toLocaleString()}`];

  Object.entries(company).forEach(([k, v]) => {
    const val = v.단가 ? v.단가 * consoleCbm : (v.COST || 0);
    if (v.CURRENCY === 'USD') usdTotal += val;
    else krwTotal += val;
    const sign = v.CURRENCY === 'USD' ? '$' : '₩';
    lines.push(`${k} : ${sign}${v.CURRENCY === 'USD' ? roundUSD(val).toLocaleString() : roundKRW(val).toLocaleString()}`);
  });

  domesticCostBox.innerHTML = `$ ${roundUSD(usdTotal).toLocaleString()}<br>₩ ${roundKRW(krwTotal).toLocaleString()}`;
  domesticDescBox.innerHTML = lines.join('<br>');

  const sum = roundKRW(usdTotal * usdToKrwRate) + roundKRW(krwTotal);
  domesticSumBox.innerHTML = `합계(KRW) : ₩${sum.toLocaleString()}`;
}

// --------- 콘솔업체 도착지 비용 ---------
function updateArrivalDesc() {
  const poeKey = poeSel.value;
  const partnerKey = partnerSel.value;
  const totalCbm = +totalCbmInput.value || 0;
  const consoleCbm = +consoleCbmInput.value || 0;

  if (!poeKey || !partnerKey || !totalCbm || !consoleCbm) {
    arrivalCostBox.innerHTML = '$0';
    arrivalDescBox.innerHTML = '';
    return;
  }

  const node = gData[poeKey]?.partner?.[partnerKey];
  const drayage = (node.drayage || 0) / totalCbm * consoleCbm;
  const devaning = (node.devaning || 0) / totalCbm * consoleCbm;
  const total = drayage + devaning;

  arrivalCostBox.innerHTML = `$ ${roundUSD(total).toLocaleString()}`;
  arrivalDescBox.innerHTML = `DRAYAGE : $${roundUSD(drayage).toLocaleString()}<br>DEVANING : $${roundUSD(devaning).toLocaleString()}`;
}

// --------- PUMEX 국내 비용 ---------
function updatePumexDomesticDesc() {
  const poeKey = poeSel.value;
  const totalCbm = +totalCbmInput.value || 0;
  const consoleCbm = +consoleCbmInput.value || 0;
  const rate40 = +rate40hcInput.value || 0;

  if (!poeKey || !totalCbm || !consoleCbm) {
    pumexDomesticCostBox.innerHTML = '₩0';
    pumexDomesticDescBox.innerHTML = '';
    pumexSumBox.innerHTML = '합계(KRW) : ₩0';
    return;
  }

  const node = gData[poeKey];
  const list = node.OFC || {};

  let usdTotal = (rate40 / totalCbm * consoleCbm);
  const lines = [`OFC : $${roundUSD(usdTotal).toLocaleString()}`];
  let krwTotal = 0;

  Object.entries(list).forEach(([k, v]) => {
    const val = v.COST || 0;
    const result = val / totalCbm * consoleCbm;
    if (v.CURRENCY === 'USD') usdTotal += result;
    else krwTotal += result;
    const sign = v.CURRENCY === 'USD' ? '$' : '₩';
    lines.push(`${k} : ${sign}${v.CURRENCY === 'USD' ? roundUSD(result).toLocaleString() : roundKRW(result).toLocaleString()}`);
  });

  pumexDomesticCostBox.innerHTML = `$ ${roundUSD(usdTotal).toLocaleString()}<br>₩ ${roundKRW(krwTotal).toLocaleString()}`;
  pumexDomesticDescBox.innerHTML = lines.join('<br>');

  const sum = roundKRW(usdTotal * usdToKrwRate) + roundKRW(krwTotal);
  pumexSumBox.innerHTML = `합계(KRW) : ₩${sum.toLocaleString()}`;
}

// --------- PUMEX 도착지 비용 ---------
function updatePumexArrivalDesc() {
  const poeKey = poeSel.value;
  const totalCbm = +totalCbmInput.value || 0;
  const consoleCbm = +consoleCbmInput.value || 0;
  const partnerKey = partnerSel.value;

  if (!poeKey || !partnerKey || !totalCbm || !consoleCbm) {
    pumexArrivalCostBox.innerHTML = '$0';
    pumexArrivalDescBox.innerHTML = '';
    return;
  }

  const node = gData[poeKey]?.partner?.[partnerKey];
  const drayage = (node.drayage || 0) / totalCbm * consoleCbm;
  const devaning = (node.devaning || 0) / totalCbm * consoleCbm;
  const total = drayage + devaning;

  pumexArrivalCostBox.innerHTML = `$ ${roundUSD(total).toLocaleString()}`;
  pumexArrivalDescBox.innerHTML = `DRAYAGE : $${roundUSD(drayage).toLocaleString()}<br>DEVANING : $${roundUSD(devaning).toLocaleString()}`;
}

// --------- 이벤트 연결 ---------
[poeSel, partnerSel, consoleSel, cbmRateInput, rate40hcInput, consoleCbmInput, totalCbmInput]
  .forEach(el => {
    el.addEventListener('change', () => {
      updateDomesticDesc();
      updateArrivalDesc();
      updatePumexDomesticDesc();
      updatePumexArrivalDesc();
    });
    el.addEventListener('input', () => {
      updateDomesticDesc();
      updateArrivalDesc();
      updatePumexDomesticDesc();
      updatePumexArrivalDesc();
    });
  });
  
</script>
<script src="exchange.js"></script>
  
</html>
