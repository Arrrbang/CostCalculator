<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Searchable Dropdowns</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .dropdown-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-width: 300px;
      margin: auto;
    }
    .custom-dropdown {
      position: relative;
      width: 100%;
    }
    .custom-dropdown input {
      padding: 10px;
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
    }
    .custom-dropdown ul {
      list-style: none;
      margin: 0;
      padding: 0;
      position: absolute;
      width: 100%;
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid #ccc;
      background-color: white;
      z-index: 1000;
      display: none;
    }
    .custom-dropdown ul li {
      padding: 10px;
      cursor: pointer;
    }
    .custom-dropdown ul li:hover {
      background-color: #f0f0f0;
    }
    button {
      padding: 10px;
      font-size: 1rem;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <h1>Searchable Dropdown Navigation</h1>
  <div class="dropdown-container">
    <div class="custom-dropdown">
      <input type="text" id="country-search" placeholder="Search for a Country" autocomplete="off">
      <ul id="country-dropdown"></ul>
    </div>
    <div class="custom-dropdown">
      <input type="text" id="region-search" placeholder="Search for a Region" autocomplete="off" disabled>
      <ul id="region-dropdown"></ul>
    </div>
    <div class="custom-dropdown">
      <input type="text" id="company-search" placeholder="Search for a Company" autocomplete="off" disabled>
      <ul id="company-dropdown"></ul>
    </div>
    <button id="navigate-button" disabled>Go to Page</button>
  </div>

  <script>
    // Fetch locations from listlocation.json
    const fetchLocations = async () => {
      const response = await fetch('listlocation.json');
      return await response.json();
    };

    // Populate dropdown with search functionality
    const populateSearchableDropdown = (input, dropdown, options, onSelect) => {
      const updateDropdown = (filter = "") => {
        dropdown.innerHTML = "";
        options
          .filter(option => option.text.toLowerCase().includes(filter.toLowerCase()))
          .forEach(option => {
            const li = document.createElement("li");
            li.textContent = option.text;
            li.dataset.value = option.value;
            li.addEventListener("click", () => {
              input.value = li.textContent;
              dropdown.style.display = "none";
              onSelect(li.dataset.value);
            });
            dropdown.appendChild(li);
          });
        dropdown.style.display = dropdown.innerHTML ? "block" : "none";
      };

      input.addEventListener("input", () => updateDropdown(input.value));
      input.addEventListener("focus", () => updateDropdown(input.value));
      input.addEventListener("blur", () => setTimeout(() => dropdown.style.display = "none", 150));

      // Initial population
      updateDropdown();
    };

    // Initialize the page
    const initializePage = async () => {
      const locations = await fetchLocations();

      const countrySearch = document.getElementById("country-search");
      const countryDropdown = document.getElementById("country-dropdown");

      const regionSearch = document.getElementById("region-search");
      const regionDropdown = document.getElementById("region-dropdown");

      const companySearch = document.getElementById("company-search");
      const companyDropdown = document.getElementById("company-dropdown");

      const navigateButton = document.getElementById("navigate-button");

      // Populate countries
      const countries = [...new Set(locations.map(loc => loc.country))].map(c => ({ text: c, value: c }));
      populateSearchableDropdown(countrySearch, countryDropdown, countries, selectedCountry => {
        const regions = locations
          .filter(loc => loc.country === selectedCountry)
          .map(loc => ({ text: loc.name, value: loc.name }));
        populateSearchableDropdown(regionSearch, regionDropdown, regions, selectedRegion => {
          const companies = locations
            .filter(loc => loc.name === selectedRegion)
            .map(loc => ({ text: loc.company, value: loc.link }));
          populateSearchableDropdown(companySearch, companyDropdown, companies, selectedLink => {
            navigateButton.disabled = false;
            navigateButton.onclick = () => {
              window.location.href = selectedLink;
            };
          });
          companySearch.disabled = false;
        });
        regionSearch.disabled = false;
      });
    };

    // Start initialization
    initializePage();
  </script>
</body>
</html>
