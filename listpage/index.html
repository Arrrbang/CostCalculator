<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Dropdowns</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .dropdown-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-width: 300px;
      margin: auto;
    }
    select {
      padding: 10px;
      font-size: 1rem;
    }
    button {
      padding: 10px;
      font-size: 1rem;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <h1>Dynamic Location Navigation</h1>
  <div class="dropdown-container">
    <select id="country-dropdown">
      <option value="">Select a Country</option>
    </select>
    <select id="region-dropdown" disabled>
      <option value="">Select a Region</option>
    </select>
    <select id="company-dropdown" disabled>
      <option value="">Select a Company</option>
    </select>
    <button id="navigate-button" disabled>Go to Page</button>
  </div>

  <script>
    // Load the listlocation.json file
    const fetchLocations = async () => {
      const response = await fetch('listlocation.json'); // Ensure this is the correct path to your JSON file
      return await response.json();
    };

    // Convert relative paths to absolute paths
    const resolvePath = (relativePath) => {
      const base = window.location.origin + window.location.pathname.replace(/\/[^/]*$/, '/'); // Get base URL
      return new URL(relativePath, base).href; // Resolve relative to base
    };

    // Populate dropdown options dynamically
    const populateDropdown = (dropdown, options, placeholder, key = "value") => {
      dropdown.innerHTML = `<option value="">${placeholder}</option>`;
      options.forEach(option => {
        const element = document.createElement("option");
        element.value = option[key];
        element.textContent = option[key];
        dropdown.appendChild(element);
      });
    };

    // Initialize dropdown functionality
    const initializePage = async () => {
      const locations = await fetchLocations();

      const countryDropdown = document.getElementById("country-dropdown");
      const regionDropdown = document.getElementById("region-dropdown");
      const companyDropdown = document.getElementById("company-dropdown");
      const navigateButton = document.getElementById("navigate-button");

      // Populate the country dropdown
      const countries = [...new Set(locations.map(loc => loc.country))];
      populateDropdown(countryDropdown, countries.map(c => ({ value: c })), "Select a Country");

      // Handle country selection
      countryDropdown.addEventListener("change", () => {
        const selectedCountry = countryDropdown.value;
        if (selectedCountry) {
          const regions = locations
            .filter(loc => loc.country === selectedCountry)
            .map(loc => ({ value: loc.name }));
          populateDropdown(regionDropdown, regions, "Select a Region");
          regionDropdown.disabled = false;
          companyDropdown.disabled = true;
          navigateButton.disabled = true;
        } else {
          regionDropdown.disabled = true;
          companyDropdown.disabled = true;
          navigateButton.disabled = true;
        }
      });

      // Handle region selection
      regionDropdown.addEventListener("change", () => {
        const selectedRegion = regionDropdown.value;
        if (selectedRegion) {
          const companies = locations
            .filter(loc => loc.name === selectedRegion)
            .map(loc => ({ value: loc.link, text: loc.company })); // Use `company` for display, `link` for value
          populateDropdown(companyDropdown, companies, "Select a Company", "text");
          companyDropdown.disabled = false;
          navigateButton.disabled = true;
        } else {
          companyDropdown.disabled = true;
          navigateButton.disabled = true;
        }
      });

      // Handle company selection
      companyDropdown.addEventListener("change", () => {
        const selectedLink = companyDropdown.value;
        if (selectedLink) {
          const resolvedLink = resolvePath(selectedLink); // Convert to absolute path
          navigateButton.disabled = false;
          navigateButton.onclick = () => {
            window.location.href = resolvedLink; // Use absolute path for navigation
          };
        } else {
          navigateButton.disabled = true;
        }
      });
    };

    // Start the initialization
    initializePage();
  </script>
</body>
</html>
