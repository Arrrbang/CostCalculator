<!DOCTYPE html>
<html>
<head>
  <title>Leaflet MAPS</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css" />
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <style>
    html, body {width: 100%; height: 100%; margin: 0; padding: 0;}
    #map {position: absolute; top: 0; bottom: 0; right: 0; left: 0; height: 75vh;} /* Adjust height to 75% of the viewport */
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    var map = L.map('map').setView([33.0, -83.5], 7);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // JSON 파일에서 데이터를 로드
    fetch('./locations.json') // JSON 파일 경로
      .then(response => {
        if (!response.ok) {
          throw new Error('Failed to fetch JSON');
        }
        return response.json();
      })
      .then(locations => {
        locations.forEach(function(location) {
          var customIcon = L.AwesomeMarkers.icon({
            extraClasses: 'fa-rotate-0',
            icon: 'info-sign',
            iconColor: 'white',
            markerColor: 'red',
            prefix: 'glyphicon'
          });

          var marker = L.marker([location.lat, location.lng], {icon: customIcon}).addTo(map);
          
          if (location.SOSlink) {
            // 마커: 팝업에 이름과 SOS 링크 표시
            marker.bindPopup(
              `${location.name}<br><a href="javascript:void(0)" onclick="navigateTo('${location.SOSlink}')" style="text-decoration: none; color: blue;">SOS</a>`
            );
          } else {
            // 다른 마커: 팝업에 이름만 표시
            marker.bindPopup(location.name);
          }
        });
      })
      .catch(error => console.error('Error loading JSON:', error));

    // 페이지 이동 함수 (현재 창에서 이동)
    function navigateTo(link) {
      window.location.assign(link); // 현재 창에서 이동
    }

    // Add search control and keep it always open
    var geocoder = L.Control.geocoder({
      defaultMarkGeocode: false
    }).addTo(map);

    geocoder._toggle(); // Ensure the search bar is always expanded

    geocoder.on('markgeocode', function(e) {
      var bbox = e.geocode.bbox;
      var poly = L.polygon([
        bbox.getSouthEast(),
        bbox.getNorthEast(),
        bbox.getNorthWest(),
        bbox.getSouthWest()
      ]).addTo(map);
      map.fitBounds(poly.getBounds());
    });
  </script>
</body>
</html>


